SELECT
	p.PAY_SYSID,
	NULLIF(REPLACE(REPLACE(PYBL_STATUS,CHAR(13), ''), CHAR(10), ''),'') AS PYBL_STATUS,
	EVENT_PROC_SYSID,
	EVENT_RPT_SYSID,
	COALESCE(p.BEN_SYSID,cm.BEN_SYSID) AS BEN_SYSID,
	REP_SYSID,
	DEAL_SYSID,
	COM_SYSID,
	DIST_SYSID,
	TRX_SYSID,
	COALESCE(p.IVR_SYSID,cm.LNK_IVR_SYSID) AS IVR_SYSID,
	COALESCE(p.PLN_SYSID,cm.LNK_PLN_SYSID) AS PLN_SYSID,
	ACT_SYSID,
	IVD_SYSID,
	NULLIF(REPLACE(REPLACE(MGT_CD,CHAR(13), ''), CHAR(10), ''),'') AS MGT_CD,
	NULLIF(REPLACE(REPLACE(TRX_CD,CHAR(13), ''), CHAR(10), ''),'') AS TRX_CD,
	PROC_DT,
	PAID_DT,
	PAY_PERIOD,
	TAX_YEAR,
	TRADE_DT,
	CAST(GRSS_AMT AS VARCHAR) AS GRSS_AMT,
	CAST(COM_DLR AS VARCHAR) AS COM_DLR,
	CAST(COM_PYBL AS VARCHAR) AS COM_PYBL,
	CAST(COM_BEN_PYBL AS VARCHAR) AS COM_BEN_PYBL,
	CAST(TICKET_CHG AS VARCHAR) AS TICKET_CHG,
	NULLIF(REPLACE(REPLACE(PAY_CD,CHAR(13), ''), CHAR(10), ''),'') AS PAY_CD,
	NULLIF(REPLACE(REPLACE(COALESCE(p.COM_PROD_CD,cm.COM_PROD_CD),CHAR(13), ''), CHAR(10), ''),'') AS COM_PROD_CD,
	CAST(AMOUNT AS VARCHAR) AS AMOUNT,
	USR_SYSID,
	OTX_SYSID,
	DISPLAY_FLAG,
	DLR_MINIMUM,
	ORIG_PAY_PER,
	NULLIF(REPLACE(REPLACE(COALESCE(p.IVT_TYPE,cm.IVT_TYPE),CHAR(13), ''), CHAR(10), ''),'') AS IVT_TYPE,
	COM_PAY_SYSID,
	INTERNAL_COMM,
	WRHS_IND,
	CONVERT(DATE, GETDATE()) AS MD_LOADDATE,
	'IAS-UNIVERIS' AS MD_SRCSYSTEM
FROM
	dbo.PAYABLE p (nolock)
LEFT OUTER JOIN dbo.COM_MANUAL cm (nolock) ON cm.COM_MANUAL_SYSID =p.COM_SYSID 
WHERE YEAR(PAID_DT)= YEAR(GETDATE()) AND MONTH(PAID_DT)= MONTH(GETDATE())-1 and NULLIF(REPLACE(REPLACE(PYBL_STATUS,CHAR(13), ''), CHAR(10), ''),'')<>'GE'
